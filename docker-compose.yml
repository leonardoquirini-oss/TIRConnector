services:
      tirconnector:
        build:
          context: .
          dockerfile: Dockerfile
        container_name: tirconnector-api
        ports:
          - "9090:8080"
        environment:
          - ASPNETCORE_ENVIRONMENT=Production

          # DB Locale (SQL Server - TIR)
          - ConnectionStrings__DefaultConnection=Server=172.28.234.122,1433;Database=TirSQL;User Id=sa;Password=saSA2025@@;TrustServerCertificate=True;Encrypt=False;MultipleActiveResultSets=true
          - ConnectionStrings__PostgresConnection=Host=172.28.234.122;Port=5432;Database=tirconnectordb;Username=tirconnector;Password=tirconnector

          # Adhoc Connector su 192.168.0.10
          #- ConnectionStrings__PostgresConnection=Host=192.168.0.12;Port=5432;Database=adhocconnectordb;Username=adhocconnector;Password=adhocconnector
          #- ConnectionStrings__DefaultConnection=Data Source=192.168.0.10,1433;Initial Catalog=AHR_BERNARDINI;Persist Security Info=True;User ID=polo;Password=p0l01nf.;Pooling=False;MultipleActiveResultSets=False;Encrypt=False;TrustServerCertificate=True;Command Timeout=0

          # TIR Connector su 192.168.0.10
          #- ConnectionStrings__PostgresConnection=Host=192.168.0.12;Port=5432;Database=tirconnectordb;Username=tirconnector;Password=@@TirConn2025
          #- ConnectionStrings__DefaultConnection=Data Source=192.168.0.10\TIR;Initial Catalog=TirSQL;Persist Security Info=True;User ID=UtenteSolaLettura;Password=test;Pooling=False;MultipleActiveResultSets=False;Encrypt=True;TrustServerCertificate=True;Command Timeout=0

          - ApiKeySettings__Keys=default-key-change-me,another-key

          - AdminUI__AppName=DEVEL

          - Valkey__ConnectionString=172.28.234.122:6379
          - Valkey__Password=
          - Valkey__Database=0

          - ContainerCache__EnableScheduler=True
          
          # A mezzanotte
          - ContainerCache__CronExpression=0 0 * * * *

          - Cors__AllowedOrigins__0=*          
        volumes:
          - ./logs:/app/logs
        restart: unless-stopped
        networks:
          - tirconnector-network
        healthcheck:
          test: ["CMD", "curl", "-f", "http://localhost:8080/api/health"]
          interval: 30s
          timeout: 3s
          retries: 3
          start_period: 10s

networks:
  tirconnector-network:
    driver: bridge

volumes:
  logs:
